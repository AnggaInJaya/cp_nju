<div class="container mt-4">
  <div class="row mb-4">
    <h2>Produk Laminating</h2> 
    <div class="col-auto col-md-8" style="<%= mobile? ? 'font-size: small;' : '' %>">
      <ul class="nav nav-tabs mb-3">
        <li class="nav-item">
          <%= link_to "All", products_path(q: (params[:q]&.to_unsafe_h || {}).except(:category_id_eq)), class: "#{mobile? ? 'small' : ''} nav-link #{'active' unless params.dig(:q, :category_id_eq).present?}" %>
        </li>
        <% Category.all.each do |category| %>
          <li class="nav-item">
            <%= link_to (mobile? ? category.name.remove('laminating').upcase : category.name), products_path(q: (params[:q]&.to_unsafe_h || {}).merge(category_id_eq: category.id)), class: "#{mobile? ? 'small' : ''} nav-link #{'active' if params.dig(:q, :category_id_eq).to_s == category.id.to_s}" %>
          </li>
        <% end %>
      </ul>
    </div>
    <div class="col-12 col-md-4">
      <% unless mobile? %>
        <div class="mb-2"></div>
      <% end %>

      <%= search_form_for @q, url: products_path do |f| %>
        <%= f.hidden_field :category_id_eq, value: params.dig(:q, :category_id_eq) %>
        <div class="d-flex">
            <%= f.search_field :name_cont, class: "form-control form-control-sm me-2", placeholder: "Search products..." %>
            <%= f.submit "Search", class: "btn btn-primary btn-sm" %>
            <%= link_to "Reset", products_path, class: "btn btn-outline-secondary btn-sm ms-2" %>
        </div>
      <% end %>
    </div>
  </div>

  <% if @products.any? %>
    <div class="row row-cols-2 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-4">
      <% @products.each do |product| %>
        <div class="col">
          <div class="card h-100 shadow-sm product-card">
            <% if product.avatars.attached? %>
              <%= image_tag product.avatars.first, class: "card-img-top", style: "height: #{mobile? ? 150 : 200}px; object-fit: cover;", alt: product.name %>
            <% else %>
              <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: <%= mobile? ? 150 : 200 %>px;object-fit: cover;border-radius: 10px;">
                <span class="text-muted">No Image</span>
              </div>
            <% end %>
            <div class="card-body d-flex flex-column">
              <p class="card-text  <%= mobile? ? 'small' : 'text-sm' %>" style="max-height: 4em;"><%= product.name %></p>
              <div class="mt-auto">
                <%= link_to "View Details", product_path(product), class: "btn btn-outline-primary w-100 #{mobile? ? 'btn-sm' : ''}" %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <div class="d-flex justify-content-center mt-4">
      <%= paginate @products, theme: 'bootstrap-5' %>
    </div>
  <% else %>
    <div class="alert alert-info text-center">
      <h4>No products found</h4>
      <p>Try adjusting your search criteria.</p>
    </div>
  <% end %>
</div>
